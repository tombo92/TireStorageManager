{% extends 'base.html' %}
{% block content %}
<h3><i class="bi bi-hdd-network"></i> Backups</h3>
<div class="mb-3 d-flex gap-2">
    <a class="btn btn-outline-primary" href="{{ url_for('run_backup') }}">
        <i class="bi bi-cloud-arrow-up"></i> Backup jetzt erstellen
    </a>
    <!-- NEW -->
    <a class="btn btn-outline-success" href="{{ url_for('export_csv_now') }}">
        <i class="bi bi-filetype-csv"></i> CSV jetzt exportieren
    </a>
</div>
<div class="table-responsive">
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>Datei</th>
                <th>Typ</th>
                <th>Größe</th>
                <th>Erstellt</th>
                <th>Aktion</th>
            </tr>
        </thead>
        <tbody>
            {% for b in backups %}
            <tr>
                <td><code>{{ b.name }}</code></td>
                <td class="text-nowrap">
                    {% if b.type == 'csv' %}
                    <span class="badge text-bg-success"><i class="bi bi-filetype-csv"></i> CSV</span>
                    {% else %}
                    <span class="badge text-bg-secondary"><i class="bi bi-hdd"></i> DB</span>
                    {% endif %}
                </td>
                <td>{{ b.size_kb }} KB</td>
                <td>{{ b.mtime }}</td>
                <td><a class="btn btn-sm btn-outline-primary"
                        href="{{ url_for('download_backup', filename=b.name) }}"><i class="bi bi-download"></i>
                        Herunterladen</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% if not backups %}
<div class="alert alert-info">Noch keine Backups vorhanden.</div>
{% endif %}
{% endblock %}